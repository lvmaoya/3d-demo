<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>全景展示 Demo</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    #toolbar {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      align-items: center;
      z-index: 10;
      background: transparent;
      padding: 0;
      border: none;
    }
    #toolbar button {
      color: #1f2937;
      background: linear-gradient(180deg, #ffffff, #f7f7f7);
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 12px;
      padding: 10px 16px;
      cursor: pointer;
      outline: none;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px rgba(255,255,255,0.70);
      transition: background .15s ease, transform .1s ease, box-shadow .15s ease, border-color .15s ease;
    }
    #toolbar button:hover {
      background: linear-gradient(180deg, #f9fafb, #f0f0f0);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.20), inset 0 1px rgba(255,255,255,0.80);
    }
    #toolbar button:active {
      transform: translateY(0);
      background: linear-gradient(180deg, #efefef, #e7e7e7);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15), inset 0 1px rgba(255,255,255,0.70);
    }
    #toolbar button:focus-visible {
      box-shadow: 0 0 0 2px rgba(2,132,199,0.35), 0 8px 22px rgba(0,0,0,0.20);
    }
    #toolbar button[data-active="true"] {
      color: #0b6baf;
      background: linear-gradient(180deg, #e0f2fe, #bae6fd);
      border-color: rgba(2,132,199,0.45);
      box-shadow: 0 8px 24px rgba(2,132,199,0.25), inset 0 1px rgba(255,255,255,0.85);
    }
    #toolbar .label {
      display: none;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="toolbar">
    <button id="btn1" data-group="pano" data-active="false">全景 1</button>
    <button id="btn2" data-group="pano" data-active="false">全景 2</button>
    <button id="fs" data-toggle>全屏</button>
    <button id="auto" data-toggle>自动旋转</button>
    <button id="zoomIn">放大</button>
    <button id="zoomOut">缩小</button>
  </div>
  <div id="loading" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);color:#fff;background:rgba(0,0,0,0.5);padding:12px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.15);">图片加载中…</div>
  <canvas id="c"></canvas>
  <script type="module">
    import * as THREE from 'https://esm.sh/three@0.159.0';
    import { OrbitControls } from 'https://esm.sh/three@0.159.0/examples/jsm/controls/OrbitControls.js';

    const canvas = document.getElementById('c');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
    camera.position.set(0, 0, 0.1);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableZoom = false;
    controls.enablePan = false;
    controls.rotateSpeed = 0.3;
    controls.zoomSpeed = 0.5;
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;

    const geometry = new THREE.SphereGeometry(1, 64, 64);
    const material = new THREE.MeshBasicMaterial({ side: THREE.BackSide });
    const mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);

    const textures = {
      //pano1: 'assets/665b0d2b94140fb66eb0c1bfba5f440a.jpg',
      //pano2: 'assets/f30c6dd6e06bb8be870b6ed7ccd96afc.jpg'
      pano1: 'assets/a98b0e5cee1b778588ae6b48e5643b72.jpg',
      pano2: 'assets/beea51b1dbe12ccd4f47349bc4489e1a.jpg'
    };

    const loader = new THREE.TextureLoader();
    let t1, t2;

    function setupTexture(t) {
      t.colorSpace = THREE.SRGBColorSpace;
      t.minFilter = THREE.LinearFilter;
      t.magFilter = THREE.LinearFilter;
      t.generateMipmaps = false;
      t.wrapS = THREE.RepeatWrapping;
      t.wrapT = THREE.ClampToEdgeWrapping;
      t.repeat.x = -1;
      t.offset.x = 1;
      t.anisotropy = renderer.capabilities.getMaxAnisotropy();
    }

    function applyTexture(t) {
      material.map = t;
      material.needsUpdate = true;
      document.getElementById('loading').style.display = 'none';
    }
    function setActiveBtn(id) {
      document.querySelectorAll('#toolbar button[data-group="pano"]').forEach(b => b.setAttribute('data-active', 'false'));
      const btn = document.getElementById(id);
      if (btn) btn.setAttribute('data-active', 'true');
    }

    t1 = loader.load(textures.pano1, () => { setupTexture(t1); applyTexture(t1); renderOnce(); }, () => {}, () => {});
    t2 = loader.load(textures.pano2, () => { setupTexture(t2); }, () => {}, () => {});

    function renderOnce() {
      renderer.render(scene, camera);
    }

    let fovTarget = camera.fov;
    const fovMin = 30, fovMax = 100, fovEase = 0.15;
    renderer.domElement.addEventListener('wheel', (e) => {
      e.preventDefault();
      const delta = -e.deltaY;
      fovTarget = THREE.MathUtils.clamp(fovTarget + delta * 0.05, fovMin, fovMax);
    }, { passive: false });

    function resize() {
      const w = window.innerWidth;
      const h = window.innerHeight;
      renderer.setSize(w, h, false);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    }

    window.addEventListener('resize', resize);
    resize();

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      if (Math.abs(fovTarget - camera.fov) > 0.01) {
        camera.fov += (fovTarget - camera.fov) * fovEase;
        camera.fov = THREE.MathUtils.clamp(camera.fov, fovMin, fovMax);
        camera.updateProjectionMatrix();
      }
      renderer.render(scene, camera);
    }
    animate();

    document.getElementById('btn1').addEventListener('click', () => {
      if (t1) applyTexture(t1);
      setActiveBtn('btn1');
    });
    document.getElementById('btn2').addEventListener('click', () => {
      if (t2) applyTexture(t2);
      setActiveBtn('btn2');
    });
    document.getElementById('fs').addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.body.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    });
    document.getElementById('auto').addEventListener('click', () => {
      controls.autoRotate = !controls.autoRotate;
      controls.autoRotateSpeed = 0.2;
      const btn = document.getElementById('auto');
      btn.setAttribute('data-active', controls.autoRotate ? 'true' : 'false');
    });
    document.getElementById('zoomIn').addEventListener('click', () => {
      fovTarget = Math.max(fovMin, fovTarget - 5);
    });
    document.getElementById('zoomOut').addEventListener('click', () => {
      fovTarget = Math.min(fovMax, fovTarget + 5);
    });
    document.addEventListener('fullscreenchange', () => {
      const fsBtn = document.getElementById('fs');
      fsBtn.setAttribute('data-active', document.fullscreenElement ? 'true' : 'false');
    });
  </script>
</body>
</html>
